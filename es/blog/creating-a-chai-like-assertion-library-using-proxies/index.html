<!DOCTYPE html>
<html lang="es" class="astro-TLGC2LXC">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>Creando una librería de aserciones estilo Chai usando proxies | Pablo Berganza</title>
    <link rel="alternate" hreflang="en" href="https://pablo.berganza.dev/blog/creating-a-chai-like-assertion-library-using-proxies">
    <link href="/apple-icon-57x57.png" rel="apple-touch-icon" sizes="57x57">
    <link href="/apple-icon-60x60.png" rel="apple-touch-icon" sizes="60x60">
    <link href="/apple-icon-72x72.png" rel="apple-touch-icon" sizes="72x72">
    <link href="/apple-icon-76x76.png" rel="apple-touch-icon" sizes="76x76">
    <link href="/apple-icon-114x114.png" rel="apple-touch-icon" sizes="114x114">
    <link href="/apple-icon-120x120.png" rel="apple-touch-icon" sizes="120x120">
    <link href="/apple-icon-144x144.png" rel="apple-touch-icon" sizes="144x144">
    <link href="/apple-icon-152x152.png" rel="apple-touch-icon" sizes="152x152">
    <link href="/apple-icon-180x180.png" rel="apple-touch-icon" sizes="180x180">
    <link href="/android-icon-192x192.png" rel="icon" sizes="192x192" type="image/png">
    <link href="/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png">
    <link href="/favicon-96x96.png" rel="icon" sizes="96x96" type="image/png">
    <link href="/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png">
    <link rel="icon" type="image/png" href="/favicon.ico">
    <link href="/manifest.json" rel="manifest">
    <meta content="#E34495" name="msapplication-TileColor">
    <meta content="ms-icon-144x144.png" name="msapplication-TileImage">
    <meta content="#E34495" name="theme-color">
    <script type="module" src="https://unpkg.com/yt-vid@0.0.5/dist/yt-vid/yt-vid.esm.js"></script>
    
    <script src="/scripts/focus-visible.js" defer></script>
    
    <script type="application/ld+json">
     {
      "@context": "https://schema.org/",
      "@type": "BlogPosting",
      "headline": "Creando una librería de aserciones estilo Chai usando proxies",
      "alternativeHeadline": "Mostrando un divertido proyecto que construí para uvu",
      "image": "https://pablo.berganza.dev/assets/blog-pics/2022-02-19.png",
      "dateCreated": "2022-02-19",
      "datePublished": "2022-02-19",
      "isFamilyFriendly": "true",
      "publisher": {
        "@type": "Person",
        "name": "Pablo Berganza",
        "url": "https://pablo.berganza.dev/",
        "email": "pablo@berganza.dev",
        "jobTitle": "Software Engineer"
      },
      "author": {
        "@type": "Person",
        "name": "Pablo Berganza",
        "url": "https://pablo.berganza.dev/",
        "email": "pablo@berganza.dev",
        "jobTitle": "Software Engineer"
      }
     }
    </script>

    <meta name="author" content="Pablo Berganza">
<meta name="description" content="Mostrando un divertido proyecto que construí para uvu">
<meta name="title" content="Creando una librería de aserciones estilo Chai usando proxies">
<meta itemprop="name" content="Creando una librería de aserciones estilo Chai usando proxies">
<meta itemprop="description" content="Mostrando un divertido proyecto que construí para uvu">
<meta name="twitter:image" content="https://pablo.berganza.dev/assets/blog-pics/2022-02-19.png"><meta property="og:image" content="https://pablo.berganza.dev/assets/blog-pics/2022-02-19.png"><meta itemprop="image" content="https://pablo.berganza.dev/assets/blog-pics/2022-02-19.png"><meta name="twitter:card" content="summary_large_image">

<meta name="twitter:title" content="Creando una librería de aserciones estilo Chai usando proxies">
<meta name="twitter:description" content="Mostrando un divertido proyecto que construí para uvu">
<meta name="twitter:site" content="Pablo_ABC">
<meta name="twitter:creator" content="Pablo_ABC">
<meta property="og:title" content="Creando una librería de aserciones estilo Chai usando proxies">
<meta property="og:url" content="https://pablo.berganza.dev/es/blog/creating-a-chai-like-assertion-library-using-proxies">
<meta property="og:site_name" content="Pablo Berganza">
<meta property="og:description" content="Mostrando un divertido proyecto que construí para uvu">
<meta property="og:locale" content="es">
<meta property="fb:admins" content="1441268341">
<meta property="fb:app_id" content="2097322913669232">
<meta property="og:type" content="article">
<meta property="article:author" content="Pablo Berganza"><meta property="article:published_time" content="2022-02-19"><meta name="twitter:data1" value="8 min"><meta name="twitter:data2" value="Pablo Berganza">

<meta name="twitter:label1" value="Tiempo de lectura"><meta name="twitter:label2" value="Autor">

    <meta name="color-scheme" content="light dark">
  <link rel="stylesheet" href="/assets/8bcea1eb.8e2e2eef.css" />
<link rel="stylesheet" href="/assets/f93fc806.f6ed43d7.css" />
<link rel="stylesheet" href="/assets/6613e5ef.62a8363b.css" />
<link rel="stylesheet" href="/assets/blog-_slug_-es-blog-_slug_.4ca07698.css" />
<link rel="stylesheet" href="/assets/Commento.942ba5ae.css" /><script type="module" src="/hoisted.b28c8895.js"></script></head>
  <body class="astro-TLGC2LXC">
    <main class="astro-TLGC2LXC">
      <a aria-label="Home page" href="/es" class="astro-FHO6HNRL">PB</a>


      <a class="lang-link astro-JBF7HU22" href="/blog/creating-a-chai-like-assertion-library-using-proxies" lang="en">
  Speak English?
</a>


      <article class="astro-TLGC2LXC">
        <header class="astro-TLGC2LXC">
          <h1 class="title astro-TLGC2LXC">Creando una librería de aserciones estilo Chai usando proxies</h1>
          <p class="astro-TLGC2LXC">Mostrando un divertido proyecto que construí para uvu</p>
        </header>
        <img alt="" class="banner astro-TLGC2LXC" src="/assets/blog-pics/2022-02-19.png" width="1136" height="852">
        <div class="stats astro-TLGC2LXC">
          <div class="ttr astro-TLGC2LXC">
            <span class="astro-TLGC2LXC">
              <svg role="img" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="astro-SEBUTMK6">
  <title>Tiempo de lectura:</title>
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" class="astro-SEBUTMK6"></path>
</svg>


            </span>
            <time datetime="8m" class="astro-TLGC2LXC">
              8
              minutos
            </time>
          </div>
          <div class="created astro-TLGC2LXC">
            <span class="astro-TLGC2LXC">
              <svg role="img" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="astro-SCJAVOL4">
  <title>Fecha de creación:</title>
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" class="astro-SCJAVOL4"></path>
</svg>


            </span>
            <time class="created-date astro-TLGC2LXC" datetime="2022-02-19">19 de febrero de 2022
            </time>
          </div>
        </div>
        <div class="tags astro-TLGC2LXC">
          Etiquetas:
          <ul class="astro-TLGC2LXC">
            <li class="astro-TLGC2LXC">
                  <a href="/es/blog/tags/javascript" class="astro-TLGC2LXC">
                    javascript
                  </a>
                </li><li class="astro-TLGC2LXC">
                  <a href="/es/blog/tags/testing" class="astro-TLGC2LXC">
                    testing
                  </a>
                </li><li class="astro-TLGC2LXC">
                  <a href="/es/blog/tags/uvu" class="astro-TLGC2LXC">
                    uvu
                  </a>
                </li><li class="astro-TLGC2LXC">
                  <a href="/es/blog/tags/webdev" class="astro-TLGC2LXC">
                    webdev
                  </a>
                </li>
          </ul>
        </div>
        <div class="tags astro-TLGC2LXC">
              También disponible en (inglés):
              <ul class="astro-TLGC2LXC">
                <li class="astro-TLGC2LXC">
                    <a href="https://dev.to/pabloabc/creating-a-chai-like-assertion-library-using-proxies-1ol7" class="astro-TLGC2LXC">dev.to</a>
                  </li>
                <li class="astro-TLGC2LXC">
                    <a href="https://hn.berganza.dev/creating-a-chai-like-assertion-library-using-proxies" class="astro-TLGC2LXC">hashnode</a>
                  </li>
              </ul>
            </div>
        <section class="content astro-TLGC2LXC">
          <details class="astro-D7DO42LA">
  <summary class="astro-D7DO42LA">
    <svg aria-hidden="true" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
    <span class="astro-D7DO42LA">Índice</span>
  </summary>
  <ol id="toc" class="astro-D7DO42LA">
    <li class="astro-D7DO42LA">
          <a href="#la-función-expect" class="astro-D7DO42LA">La función “expect”</a>
          
        </li><li class="astro-D7DO42LA">
          <a href="#dándole-significado-a-nuestras-propiedades" class="astro-D7DO42LA">Dándole significado a nuestras propiedades</a>
          
        </li><li class="astro-D7DO42LA">
          <a href="#definiendo-propiedades" class="astro-D7DO42LA">Definiendo propiedades</a>
          
        </li><li class="astro-D7DO42LA">
          <a href="#negando-aserciones" class="astro-D7DO42LA">Negando aserciones</a>
          
        </li><li class="astro-D7DO42LA">
          <a href="#evitar-lanzar-errores-normales" class="astro-D7DO42LA">Evitar lanzar errores normales</a>
          
        </li><li class="astro-D7DO42LA">
          <a href="#conclusión" class="astro-D7DO42LA">Conclusión</a>
          
        </li>
  </ol>
</details>


          <p>Durante las últimas semanas he tomado el (probablemente inútil) trabajo de migrar <a href="https://felte.dev">Felte</a> de usar Jest a usar <a href="https://github.com/lukeed/uvu">uvu</a>. Esta labor es tediosa de por sí, pero uno de los detalles que dificultan la transición es que Jest espera que hagas tus tests con una sintaxis estilo <code>expect(…).toBe*</code>; mientras que uvu te da total libertad sobre cómo realizar tus tests. Aunque uvu ofrece un paquete oficial <code>uvu/assert</code> que  te permite realizar tus tests estilo <code>assert.is(value, expected)</code>.</p>
<p>Aunque esto funciona perfectamente bien, y es posible mover todos mis tests a usar el tipo de validaciones que <code>uvu/assert</code> ofrece, me gusta la forma descriptiva de los t esta de Jest. Para poder mantener una forma similar de realizar mis tests, decidí usar <a href="https://chaijs.com">ChaiJS</a>: una librería de aserciones que es principalmente usada con <a href="https://mochajs.org">mocha</a>. Chai ofrece aserciones estilo <code>expect</code> que son, debatiblemente, más descriptivas que las que Jest ofrece. En lugar de escribir <code>expect(…).toBe(true)</code>, con Chai escribirías <code>expect(…).to.be.true</code>. En la mayor parte de casos pude usar un “search and replace” para migrar.</p>
<p>Este setup funciona perfectamente bien. Pero hay unos cuantos pequeños detalles: Los errores lanzados por las aserciones son <em>un poquito</em> distintos a los esperados por uvu. Esto significa que en algunos casos uvu muestra detalles o mensajes de error que no son muy relevantes al test que falló. O que uvu muestra diffs comparando <code>undefined</code> con <code>undefined</code>. Como un buen desarrollador con demasiado tiempo libre, decidí escribir <a href="https://xkcd.com/927/">mi propia librería de aserciones</a> sobre las aserciones proveídas por uvu: <a href="https://github.com/pablo-abc/uvu-expect">uvu-expect</a>. A continuación explicaré más o menos como lo hice.</p>
<h2 id="la-función-expect">La función “expect”</h2>
<p>El principal requisito de nuestra librería de aserciones es una función <code>expect</code> que debe recibir el velor que esperas validar.</p>
<pre is:raw="" class="astro-code" style="background-color: #282A36; overflow-x: auto;"><code><span class="line"><span style="color: #FF79C6">export</span><span style="color: #F8F8F2"> </span><span style="color: #FF79C6">function</span><span style="color: #F8F8F2"> </span><span style="color: #50FA7B">expect</span><span style="color: #F8F8F2">(</span><span style="color: #FFB86C">value</span><span style="color: #F8F8F2">) {</span></span>
<span class="line"><span style="color: #F8F8F2">  </span><span style="color: #6272A4">// corre tus asercions aquí</span></span>
<span class="line"><span style="color: #F8F8F2">}</span></span></code></pre>
<p>Si quisiéramos mantener una API similar a la de Jest, esta función podría retornar un objeto con funciones.</p>
<pre is:raw="" class="astro-code" style="background-color: #282A36; overflow-x: auto;"><code><span class="line"><span style="color: #FF79C6">export</span><span style="color: #F8F8F2"> </span><span style="color: #FF79C6">function</span><span style="color: #F8F8F2"> </span><span style="color: #50FA7B">expect</span><span style="color: #F8F8F2">(</span><span style="color: #FFB86C">value</span><span style="color: #F8F8F2">) {</span></span>
<span class="line"><span style="color: #F8F8F2">  </span><span style="color: #FF79C6">return</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #50FA7B">toBe</span><span style="color: #F8F8F2">(</span><span style="color: #FFB86C">expected</span><span style="color: #F8F8F2">) {</span></span>
<span class="line"><span style="color: #F8F8F2">      </span><span style="color: #FF79C6">if</span><span style="color: #F8F8F2"> (expected </span><span style="color: #FF79C6">!==</span><span style="color: #F8F8F2"> value) {</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #FF79C6">throw</span><span style="color: #F8F8F2"> </span><span style="color: #FF79C6; font-style: italic">new</span><span style="color: #F8F8F2"> </span><span style="color: #50FA7B">Error</span><span style="color: #F8F8F2">(</span><span style="color: #E9F284">'</span><span style="color: #F1FA8C">Expected values to be strictly equal</span><span style="color: #E9F284">'</span><span style="color: #F8F8F2">);</span></span>
<span class="line"><span style="color: #F8F8F2">      }</span></span>
<span class="line"><span style="color: #F8F8F2">    },</span></span>
<span class="line"><span style="color: #F8F8F2">  };</span></span>
<span class="line"><span style="color: #F8F8F2">}</span></span></code></pre>
<p>Pero usando Chai, me encantó la sintáxis que ofrece. Por esto, decidí usar proxies para lograr tener una API similar. Para lograrlo, podríamos empezar permitiendo encadenar palabras arbitrarias después de nuestra llamada a <code>expect</code>. Para simplificar el desarrollo, decidí no restringir las posibles palabras que se pueden encadenar.</p>
<p><strong>Proxy</strong> es un objeto de JavaScript con el que puedes “envolver” otro objeto para poder interceptar y modificar su funcionalidad. En nuestro caso lo usaremos para modificar el comportamiento de nuestro objeto cuando <em>accedemos</em> a una de sus propiedades.</p>
<pre is:raw="" class="astro-code" style="background-color: #282A36; overflow-x: auto;"><code><span class="line"><span style="color: #FF79C6">export</span><span style="color: #F8F8F2"> </span><span style="color: #FF79C6">function</span><span style="color: #F8F8F2"> </span><span style="color: #50FA7B">expect</span><span style="color: #F8F8F2">(</span><span style="color: #FFB86C">value</span><span style="color: #F8F8F2">) {</span></span>
<span class="line"><span style="color: #F8F8F2">  </span><span style="color: #FF79C6">const</span><span style="color: #F8F8F2"> proxy </span><span style="color: #FF79C6">=</span><span style="color: #F8F8F2"> </span><span style="color: #FF79C6; font-style: italic">new</span><span style="color: #F8F8F2"> </span><span style="color: #50FA7B">Proxy</span><span style="color: #F8F8F2">(</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #6272A4">// El target que querémos envolver en el proxy.</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #6272A4">// Por ahora solo es un objeto vacío.</span></span>
<span class="line"><span style="color: #F8F8F2">    {},</span></span>
<span class="line"><span style="color: #F8F8F2">    {</span></span>
<span class="line"><span style="color: #F8F8F2">      </span><span style="color: #50FA7B">get</span><span style="color: #F8F8F2">() {</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #6272A4">// Acceder a cualquier propiedad retorna el mismo</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #6272A4">// proxy nuevamente.</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #FF79C6">return</span><span style="color: #F8F8F2"> proxy;</span></span>
<span class="line"><span style="color: #F8F8F2">      },</span></span>
<span class="line"><span style="color: #F8F8F2">    }</span></span>
<span class="line"><span style="color: #F8F8F2">  );</span></span>
<span class="line"><span style="color: #F8F8F2">  </span><span style="color: #FF79C6">return</span><span style="color: #F8F8F2"> proxy;</span></span>
<span class="line"><span style="color: #F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #50FA7B">expect</span><span style="color: #F8F8F2">().this.does.nothing.but.also.does.not.crash;</span></span></code></pre>
<p>Ahora vamos a permitir que <em>cualquier</em> palabra encadenada pueda ser llamada como una función.</p>
<pre is:raw="" class="astro-code" style="background-color: #282A36; overflow-x: auto;"><code><span class="line"><span style="color: #FF79C6">export</span><span style="color: #F8F8F2"> </span><span style="color: #FF79C6">function</span><span style="color: #F8F8F2"> </span><span style="color: #50FA7B">expect</span><span style="color: #F8F8F2">(</span><span style="color: #FFB86C">value</span><span style="color: #F8F8F2">) {</span></span>
<span class="line"><span style="color: #F8F8F2">  </span><span style="color: #FF79C6">const</span><span style="color: #F8F8F2"> proxy </span><span style="color: #FF79C6">=</span><span style="color: #F8F8F2"> </span><span style="color: #FF79C6; font-style: italic">new</span><span style="color: #F8F8F2"> </span><span style="color: #50FA7B">Proxy</span><span style="color: #F8F8F2">(</span></span>
<span class="line"><span style="color: #F8F8F2">    {},</span></span>
<span class="line"><span style="color: #F8F8F2">    {</span></span>
<span class="line"><span style="color: #F8F8F2">      </span><span style="color: #50FA7B">get</span><span style="color: #F8F8F2">(</span><span style="color: #FFB86C">_</span><span style="color: #F8F8F2">, </span><span style="color: #FFB86C">outerProp</span><span style="color: #F8F8F2">) {</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #6272A4">// En lugar de retornar el proxy directamente,</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #6272A4">// retornamos un nuevo proxy que envuelve una</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #6272A4">// función.</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #FF79C6">return</span><span style="color: #F8F8F2"> </span><span style="color: #FF79C6; font-style: italic">new</span><span style="color: #F8F8F2"> </span><span style="color: #50FA7B">Proxy</span><span style="color: #F8F8F2">(() </span><span style="color: #FF79C6">=></span><span style="color: #F8F8F2"> proxy, {</span></span>
<span class="line"><span style="color: #F8F8F2">          </span><span style="color: #50FA7B">get</span><span style="color: #F8F8F2">(</span><span style="color: #FFB86C">_</span><span style="color: #F8F8F2">, </span><span style="color: #FFB86C">innerProp</span><span style="color: #F8F8F2">) {</span></span>
<span class="line"><span style="color: #F8F8F2">            </span><span style="color: #6272A4">// Si la función no es llamada y accedemos a</span></span>
<span class="line"><span style="color: #F8F8F2">            </span><span style="color: #6272A4">// una propiedad directamente, accederemos a la</span></span>
<span class="line"><span style="color: #F8F8F2">            </span><span style="color: #6272A4">// misma propiedad en el proxy original.</span></span>
<span class="line"><span style="color: #F8F8F2">            </span><span style="color: #FF79C6">return</span><span style="color: #F8F8F2"> proxy[innerProp];</span></span>
<span class="line"><span style="color: #F8F8F2">          },</span></span>
<span class="line"><span style="color: #F8F8F2">        });</span></span>
<span class="line"><span style="color: #F8F8F2">      },</span></span>
<span class="line"><span style="color: #F8F8F2">    }</span></span>
<span class="line"><span style="color: #F8F8F2">  );</span></span>
<span class="line"><span style="color: #F8F8F2">  </span><span style="color: #FF79C6">return</span><span style="color: #F8F8F2"> proxy;</span></span>
<span class="line"><span style="color: #F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #50FA7B">expect</span><span style="color: #F8F8F2">().this.does.</span><span style="color: #50FA7B">nothing</span><span style="color: #F8F8F2">().but.also.does.not.</span><span style="color: #50FA7B">crash</span><span style="color: #F8F8F2">();</span></span></code></pre>
<p>Con esto, ya tenemos lo básico para la sintaxis que buscamos soportar. Ahora necesitamos lograr darle <em>significado</em> a algunas propiedades. Por ejemplo, tal vez queramos que algo como <code>expect(…).to.be.null</code> revise si el value pasado a <code>expect</code> sea null o no.</p>
<h2 id="dándole-significado-a-nuestras-propiedades">Dándole significado a nuestras propiedades</h2>
<p>Podríamos revisar directamente el nombre de la propiedad siendo accedida y utilizar esto para decidir que validaciones correr. Por ejemplo, para tener una validación que revise si el valor recibido es <code>null</code>:</p>
<pre is:raw="" class="astro-code" style="background-color: #282A36; overflow-x: auto;"><code><span class="line"><span style="color: #6272A4">// Para mantenerlo breve, ignoraremos el hecho de que</span></span>
<span class="line"><span style="color: #6272A4">// las propiedades de nuestro proxy también pueden ser</span></span>
<span class="line"><span style="color: #6272A4">// funciones.</span></span>
<span class="line"><span style="color: #FF79C6">export</span><span style="color: #F8F8F2"> </span><span style="color: #FF79C6">function</span><span style="color: #F8F8F2"> </span><span style="color: #50FA7B">expect</span><span style="color: #F8F8F2">(</span><span style="color: #FFB86C">value</span><span style="color: #F8F8F2">) {</span></span>
<span class="line"><span style="color: #F8F8F2">  </span><span style="color: #FF79C6">const</span><span style="color: #F8F8F2"> proxy </span><span style="color: #FF79C6">=</span><span style="color: #F8F8F2"> </span><span style="color: #FF79C6; font-style: italic">new</span><span style="color: #F8F8F2"> </span><span style="color: #50FA7B">Proxy</span><span style="color: #F8F8F2">(</span></span>
<span class="line"><span style="color: #F8F8F2">    {},</span></span>
<span class="line"><span style="color: #F8F8F2">    {</span></span>
<span class="line"><span style="color: #F8F8F2">      </span><span style="color: #50FA7B">get</span><span style="color: #F8F8F2">(</span><span style="color: #FFB86C">_</span><span style="color: #F8F8F2">, </span><span style="color: #FFB86C">prop</span><span style="color: #F8F8F2">) {</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #6272A4">// `prop` es el nombre de la propiedad siendo</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #6272A4">// accedida.</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #FF79C6">switch</span><span style="color: #F8F8F2"> (prop) {</span></span>
<span class="line"><span style="color: #F8F8F2">          </span><span style="color: #FF79C6">case</span><span style="color: #F8F8F2"> </span><span style="color: #E9F284">'</span><span style="color: #F1FA8C">null</span><span style="color: #E9F284">'</span><span style="color: #F8F8F2">:</span></span>
<span class="line"><span style="color: #F8F8F2">            </span><span style="color: #FF79C6">if</span><span style="color: #F8F8F2"> (value </span><span style="color: #FF79C6">!==</span><span style="color: #F8F8F2"> </span><span style="color: #BD93F9">null</span><span style="color: #F8F8F2">) {</span></span>
<span class="line"><span style="color: #F8F8F2">              </span><span style="color: #FF79C6">throw</span><span style="color: #F8F8F2"> </span><span style="color: #FF79C6; font-style: italic">new</span><span style="color: #F8F8F2"> </span><span style="color: #50FA7B">Error</span><span style="color: #F8F8F2">(</span><span style="color: #E9F284">'</span><span style="color: #F1FA8C">Expected value to be null</span><span style="color: #E9F284">'</span><span style="color: #F8F8F2">);</span></span>
<span class="line"><span style="color: #F8F8F2">            }</span></span>
<span class="line"><span style="color: #F8F8F2">            </span><span style="color: #FF79C6">break</span><span style="color: #F8F8F2">;</span></span>
<span class="line"><span style="color: #F8F8F2">        }</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #FF79C6">return</span><span style="color: #F8F8F2"> proxy;</span></span>
<span class="line"><span style="color: #F8F8F2">      },</span></span>
<span class="line"><span style="color: #F8F8F2">    }</span></span>
<span class="line"><span style="color: #F8F8F2">  );</span></span>
<span class="line"><span style="color: #F8F8F2">  </span><span style="color: #FF79C6">return</span><span style="color: #F8F8F2"> proxy;</span></span>
<span class="line"><span style="color: #F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #50FA7B">expect</span><span style="color: #F8F8F2">(</span><span style="color: #BD93F9">null</span><span style="color: #F8F8F2">).to.be.null;</span></span>
<span class="line"><span style="color: #FF79C6">try</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">  </span><span style="color: #50FA7B">expect</span><span style="color: #F8F8F2">(</span><span style="color: #E9F284">'</span><span style="color: #F1FA8C">not null</span><span style="color: #E9F284">'</span><span style="color: #F8F8F2">).to.be.null;</span></span>
<span class="line"><span style="color: #F8F8F2">} </span><span style="color: #FF79C6">catch</span><span style="color: #F8F8F2"> (err) {</span></span>
<span class="line"><span style="color: #F8F8F2">  console.</span><span style="color: #50FA7B">log</span><span style="color: #F8F8F2">(err.message); </span><span style="color: #6272A4">// => "Expected value to be null"</span></span>
<span class="line"><span style="color: #F8F8F2">}</span></span></code></pre>
<p>Esto puede hacer que nuestra función <code>expect</code> sea algo difícil de mantener. Y agregar nuevas propiedades no será tan fácil a medida que la librería crezca. Para hacerlo más mantenible, vamos a manejar esto de una forma un poco diferente.</p>
<h2 id="definiendo-propiedades">Definiendo propiedades</h2>
<p>En lugar de envolver un objeto vacío en nuestro proxy, vamos a envolver un objeto que contiene las propiedades a las que queremos darle significado.</p>
<pre is:raw="" class="astro-code" style="background-color: #282A36; overflow-x: auto;"><code><span class="line"><span style="color: #FF79C6">const</span><span style="color: #F8F8F2"> properties </span><span style="color: #FF79C6">=</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">  </span><span style="color: #6272A4">// ...</span></span>
<span class="line"><span style="color: #F8F8F2">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF79C6">export</span><span style="color: #F8F8F2"> </span><span style="color: #FF79C6">function</span><span style="color: #F8F8F2"> </span><span style="color: #50FA7B">expect</span><span style="color: #F8F8F2">(</span><span style="color: #FFB86C">value</span><span style="color: #F8F8F2">) {</span></span>
<span class="line"><span style="color: #F8F8F2">  </span><span style="color: #FF79C6">const</span><span style="color: #F8F8F2"> proxy </span><span style="color: #FF79C6">=</span><span style="color: #F8F8F2"> </span><span style="color: #FF79C6; font-style: italic">new</span><span style="color: #F8F8F2"> </span><span style="color: #50FA7B">Proxy</span><span style="color: #F8F8F2">(properties, {</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #50FA7B">get</span><span style="color: #F8F8F2">(</span><span style="color: #FFB86C">target</span><span style="color: #F8F8F2">, </span><span style="color: #FFB86C">outerProp</span><span style="color: #F8F8F2">) {</span></span>
<span class="line"><span style="color: #F8F8F2">      </span><span style="color: #6272A4">// `target` es el mismo objeto `properties`</span></span>
<span class="line"><span style="color: #F8F8F2">      console.</span><span style="color: #50FA7B">log</span><span style="color: #F8F8F2">(target);</span></span>
<span class="line"><span style="color: #F8F8F2">      </span><span style="color: #FF79C6">return</span><span style="color: #F8F8F2"> </span><span style="color: #FF79C6; font-style: italic">new</span><span style="color: #F8F8F2"> </span><span style="color: #50FA7B">Proxy</span><span style="color: #F8F8F2">(() </span><span style="color: #FF79C6">=></span><span style="color: #F8F8F2"> proxy, {</span></span>
<span class="line"><span style="color: #F8F8F2">        </span><span style="color: #50FA7B">get</span><span style="color: #F8F8F2">(</span><span style="color: #FFB86C">_</span><span style="color: #F8F8F2">, </span><span style="color: #FFB86C">innerProp</span><span style="color: #F8F8F2">) {</span></span>
<span class="line"><span style="color: #F8F8F2">          </span><span style="color: #FF79C6">return</span><span style="color: #F8F8F2"> proxy[innerProp];</span></span>
<span class="line"><span style="color: #F8F8F2">        },</span></span>
<span class="line"><span style="color: #F8F8F2">      });</span></span>
<span class="line"><span style="color: #F8F8F2">    },</span></span>
<span class="line"><span style="color: #F8F8F2">  });</span></span>
<span class="line"><span style="color: #F8F8F2">  </span><span style="color: #FF79C6">return</span><span style="color: #F8F8F2"> proxy;</span></span>
<span class="line"><span style="color: #F8F8F2">}</span></span></code></pre>
<p>Decidí definir cada propiedad como un objeto que contiene dos funciones: <code>onAccess</code>, que se ejecuta cuando una propiedad es accedida; y <code>onCall</code>, que se ejecuta cuando una propiedad se llama como una función. Por ejemplo, nuestra propiedad para <code>null</code> podría verse así:</p>
<pre is:raw="" class="astro-code" style="background-color: #282A36; overflow-x: auto;"><code><span class="line"><span style="color: #FF79C6">const</span><span style="color: #F8F8F2"> isNull </span><span style="color: #FF79C6">=</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">  </span><span style="color: #50FA7B">onAccess</span><span style="color: #F8F8F2">(</span><span style="color: #FFB86C">actual</span><span style="color: #F8F8F2">) {</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #FF79C6">if</span><span style="color: #F8F8F2"> (actual </span><span style="color: #FF79C6">!==</span><span style="color: #F8F8F2"> </span><span style="color: #BD93F9">null</span><span style="color: #F8F8F2">) {</span></span>
<span class="line"><span style="color: #F8F8F2">      </span><span style="color: #FF79C6">throw</span><span style="color: #F8F8F2"> </span><span style="color: #FF79C6; font-style: italic">new</span><span style="color: #F8F8F2"> </span><span style="color: #50FA7B">Error</span><span style="color: #F8F8F2">(</span><span style="color: #E9F284">'</span><span style="color: #F1FA8C">Expected value to be null</span><span style="color: #E9F284">'</span><span style="color: #F8F8F2">);</span></span>
<span class="line"><span style="color: #F8F8F2">    }</span></span>
<span class="line"><span style="color: #F8F8F2">  },</span></span>
<span class="line"><span style="color: #F8F8F2">};</span></span></code></pre>
<p>También podríamos definir una propiedad para validar que dos valores sean estrictamente iguales:</p>
<pre is:raw="" class="astro-code" style="background-color: #282A36; overflow-x: auto;"><code><span class="line"><span style="color: #FF79C6">const</span><span style="color: #F8F8F2"> isEqual </span><span style="color: #FF79C6">=</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">  </span><span style="color: #50FA7B">onCall</span><span style="color: #F8F8F2">(</span><span style="color: #FFB86C">actual</span><span style="color: #F8F8F2">, </span><span style="color: #FFB86C">expected</span><span style="color: #F8F8F2">) {</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #FF79C6">if</span><span style="color: #F8F8F2"> (actual </span><span style="color: #FF79C6">!==</span><span style="color: #F8F8F2"> expected) {</span></span>
<span class="line"><span style="color: #F8F8F2">      </span><span style="color: #FF79C6">throw</span><span style="color: #F8F8F2"> </span><span style="color: #FF79C6; font-style: italic">new</span><span style="color: #F8F8F2"> </span><span style="color: #50FA7B">Error</span><span style="color: #F8F8F2">(</span><span style="color: #E9F284">'</span><span style="color: #F1FA8C">Expected values to be strictly equal</span><span style="color: #E9F284">'</span><span style="color: #F8F8F2">);</span></span>
<span class="line"><span style="color: #F8F8F2">    }</span></span>
<span class="line"><span style="color: #F8F8F2">  },</span></span>
<span class="line"><span style="color: #F8F8F2">};</span></span></code></pre>
<p>Ahora podemos modificar nuestra función <code>expect</code> para que llame las funciones de estas propiedades cuando estén disponibles:</p>
<pre is:raw="" class="astro-code" style="background-color: #282A36; overflow-x: auto;"><code><span class="line"><span style="color: #6272A4">// Añadimos las propiedades que definimos</span></span>
<span class="line"><span style="color: #6272A4">// anteriormente a nuestro objeto `properties`.</span></span>
<span class="line"><span style="color: #FF79C6">const</span><span style="color: #F8F8F2"> properties </span><span style="color: #FF79C6">=</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">  null</span><span style="color: #FF79C6">:</span><span style="color: #F8F8F2"> isNull,</span></span>
<span class="line"><span style="color: #F8F8F2">  equal</span><span style="color: #FF79C6">:</span><span style="color: #F8F8F2"> isEqual,</span></span>
<span class="line"><span style="color: #F8F8F2">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF79C6">export</span><span style="color: #F8F8F2"> </span><span style="color: #FF79C6">function</span><span style="color: #F8F8F2"> </span><span style="color: #50FA7B">expect</span><span style="color: #F8F8F2">(</span><span style="color: #FFB86C">value</span><span style="color: #F8F8F2">) {</span></span>
<span class="line"><span style="color: #F8F8F2">  </span><span style="color: #FF79C6">const</span><span style="color: #F8F8F2"> proxy </span><span style="color: #FF79C6">=</span><span style="color: #F8F8F2"> </span><span style="color: #FF79C6; font-style: italic">new</span><span style="color: #F8F8F2"> </span><span style="color: #50FA7B">Proxy</span><span style="color: #F8F8F2">(properties, {</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #50FA7B">get</span><span style="color: #F8F8F2">(</span><span style="color: #FFB86C">target</span><span style="color: #F8F8F2">, </span><span style="color: #FFB86C">outerProp</span><span style="color: #F8F8F2">) {</span></span>
<span class="line"><span style="color: #F8F8F2">      </span><span style="color: #FF79C6">const</span><span style="color: #F8F8F2"> property </span><span style="color: #FF79C6">=</span><span style="color: #F8F8F2"> target[outerProp];</span></span>
<span class="line"><span style="color: #F8F8F2">		</span><span style="color: #6272A4">// Ejecutamos `onAccess` cuando esté disponible.</span></span>
<span class="line"><span style="color: #F8F8F2">      property?.</span><span style="color: #50FA7B">onAccess</span><span style="color: #F8F8F2">?.(value);</span></span>
<span class="line"><span style="color: #F8F8F2">      </span><span style="color: #FF79C6">return</span><span style="color: #F8F8F2"> </span><span style="color: #FF79C6; font-style: italic">new</span><span style="color: #F8F8F2"> </span><span style="color: #50FA7B">Proxy</span><span style="color: #F8F8F2">(</span></span>
<span class="line"><span style="color: #F8F8F2">        (</span><span style="color: #FF79C6">...</span><span style="color: #FFB86C">args</span><span style="color: #F8F8F2">) </span><span style="color: #FF79C6">=></span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">			</span><span style="color: #6272A4">// Ejecutamos `onCall` cuando esté disponible.</span></span>
<span class="line"><span style="color: #F8F8F2">          property?.</span><span style="color: #50FA7B">onCall</span><span style="color: #F8F8F2">?.(value, </span><span style="color: #FF79C6">...</span><span style="color: #F8F8F2">args);</span></span>
<span class="line"><span style="color: #F8F8F2">          </span><span style="color: #FF79C6">return</span><span style="color: #F8F8F2"> proxy;</span></span>
<span class="line"><span style="color: #F8F8F2">        },</span></span>
<span class="line"><span style="color: #F8F8F2">        {</span></span>
<span class="line"><span style="color: #F8F8F2">          </span><span style="color: #50FA7B">get</span><span style="color: #F8F8F2">(</span><span style="color: #FFB86C">_</span><span style="color: #F8F8F2">, </span><span style="color: #FFB86C">innerProp</span><span style="color: #F8F8F2">) {</span></span>
<span class="line"><span style="color: #F8F8F2">            </span><span style="color: #FF79C6">return</span><span style="color: #F8F8F2"> proxy[innerProp];</span></span>
<span class="line"><span style="color: #F8F8F2">          },</span></span>
<span class="line"><span style="color: #F8F8F2">        }</span></span>
<span class="line"><span style="color: #F8F8F2">      );</span></span>
<span class="line"><span style="color: #F8F8F2">    },</span></span>
<span class="line"><span style="color: #F8F8F2">  });</span></span>
<span class="line"><span style="color: #F8F8F2">  </span><span style="color: #FF79C6">return</span><span style="color: #F8F8F2"> proxy;</span></span>
<span class="line"><span style="color: #F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #50FA7B">expect</span><span style="color: #F8F8F2">(</span><span style="color: #BD93F9">null</span><span style="color: #F8F8F2">).to.be.null;</span></span>
<span class="line"><span style="color: #50FA7B">expect</span><span style="color: #F8F8F2">(</span><span style="color: #E9F284">'</span><span style="color: #F1FA8C">a</span><span style="color: #E9F284">'</span><span style="color: #F8F8F2">).to.</span><span style="color: #50FA7B">equal</span><span style="color: #F8F8F2">(</span><span style="color: #E9F284">'</span><span style="color: #F1FA8C">a</span><span style="color: #E9F284">'</span><span style="color: #F8F8F2">);</span></span></code></pre>
<p>¡Ahora tenemos una muy básica librería de aserciones! Y puede ser extendida fácilmente agregando propiedades a nuestro objeto <code>properties</code>.</p>
<p>Hay un pequeño detalle que todavía no podemos manejar con nuestra implementación actual: negar aserciones. Necesitamos implementar una forma para modificar el comportamiento de aserciones futuras.</p>
<h2 id="negando-aserciones">Negando aserciones</h2>
<p>Para lograr manejar esto, necesitamos una forma de comunicarle a nuestras propiedades que la aserción siendo realizada ha sido negada. Para esto, cambiaremos un poco como definimos nuestras propiedades. En lugar de recibir el valor siendo validado como primer argumento, vamos a recibir un objeto <code>context</code> que contendrá nuestro valor siendo validado en la propiedad <code>actual</code>, y una nueva propiedad <code>negated</code> que contendrá un booleano indicando si la aserción ha sido negada. La definición de nuestras propiedades para <code>equal</code> y <code>null</code> ahora se verán así:</p>
<pre is:raw="" class="astro-code" style="background-color: #282A36; overflow-x: auto;"><code><span class="line"><span style="color: #FF79C6">const</span><span style="color: #F8F8F2"> isNull </span><span style="color: #FF79C6">=</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">  </span><span style="color: #50FA7B">onAccess</span><span style="color: #F8F8F2">(</span><span style="color: #FFB86C">context</span><span style="color: #F8F8F2">) {</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #FF79C6">if</span><span style="color: #F8F8F2"> (</span><span style="color: #FF79C6">!</span><span style="color: #F8F8F2">context.negated </span><span style="color: #FF79C6">&#x26;&#x26;</span><span style="color: #F8F8F2"> context.actual </span><span style="color: #FF79C6">!==</span><span style="color: #F8F8F2"> </span><span style="color: #BD93F9">null</span><span style="color: #F8F8F2">) {</span></span>
<span class="line"><span style="color: #F8F8F2">      </span><span style="color: #FF79C6">throw</span><span style="color: #F8F8F2"> </span><span style="color: #FF79C6; font-style: italic">new</span><span style="color: #F8F8F2"> </span><span style="color: #50FA7B">Error</span><span style="color: #F8F8F2">(</span><span style="color: #E9F284">'</span><span style="color: #F1FA8C">Expected value to be null</span><span style="color: #E9F284">'</span><span style="color: #F8F8F2">);</span></span>
<span class="line"><span style="color: #F8F8F2">    }</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #FF79C6">if</span><span style="color: #F8F8F2"> (context.negated </span><span style="color: #FF79C6">&#x26;&#x26;</span><span style="color: #F8F8F2"> context.actual </span><span style="color: #FF79C6">===</span><span style="color: #F8F8F2"> </span><span style="color: #BD93F9">null</span><span style="color: #F8F8F2">) {</span></span>
<span class="line"><span style="color: #F8F8F2">      </span><span style="color: #FF79C6">throw</span><span style="color: #F8F8F2"> </span><span style="color: #FF79C6; font-style: italic">new</span><span style="color: #F8F8F2"> </span><span style="color: #50FA7B">Error</span><span style="color: #F8F8F2">(</span><span style="color: #E9F284">'</span><span style="color: #F1FA8C">Expected value not to be null</span><span style="color: #E9F284">'</span><span style="color: #F8F8F2">);</span></span>
<span class="line"><span style="color: #F8F8F2">    }</span></span>
<span class="line"><span style="color: #F8F8F2">  },</span></span>
<span class="line"><span style="color: #F8F8F2">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF79C6">const</span><span style="color: #F8F8F2"> isEqual </span><span style="color: #FF79C6">=</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">  </span><span style="color: #50FA7B">onCall</span><span style="color: #F8F8F2">(</span><span style="color: #FFB86C">context</span><span style="color: #F8F8F2">, </span><span style="color: #FFB86C">expected</span><span style="color: #F8F8F2">) {</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #FF79C6">if</span><span style="color: #F8F8F2"> (</span><span style="color: #FF79C6">!</span><span style="color: #F8F8F2">context.negated </span><span style="color: #FF79C6">&#x26;&#x26;</span><span style="color: #F8F8F2"> context.actual </span><span style="color: #FF79C6">!==</span><span style="color: #F8F8F2"> expected) {</span></span>
<span class="line"><span style="color: #F8F8F2">      </span><span style="color: #FF79C6">throw</span><span style="color: #F8F8F2"> </span><span style="color: #FF79C6; font-style: italic">new</span><span style="color: #F8F8F2"> </span><span style="color: #50FA7B">Error</span><span style="color: #F8F8F2">(</span><span style="color: #E9F284">'</span><span style="color: #F1FA8C">Expected values to be strictly equal</span><span style="color: #E9F284">'</span><span style="color: #F8F8F2">);</span></span>
<span class="line"><span style="color: #F8F8F2">    }</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #FF79C6">if</span><span style="color: #F8F8F2"> (context.negated </span><span style="color: #FF79C6">&#x26;&#x26;</span><span style="color: #F8F8F2"> context.actual </span><span style="color: #FF79C6">===</span><span style="color: #F8F8F2"> expected) {</span></span>
<span class="line"><span style="color: #F8F8F2">      </span><span style="color: #FF79C6">throw</span><span style="color: #F8F8F2"> </span><span style="color: #FF79C6; font-style: italic">new</span><span style="color: #F8F8F2"> </span><span style="color: #50FA7B">Error</span><span style="color: #F8F8F2">(</span><span style="color: #E9F284">'</span><span style="color: #F1FA8C">Expected values not to be strictly equal</span><span style="color: #E9F284">'</span><span style="color: #F8F8F2">);</span></span>
<span class="line"><span style="color: #F8F8F2">    }</span></span>
<span class="line"><span style="color: #F8F8F2">  },</span></span>
<span class="line"><span style="color: #F8F8F2">};</span></span></code></pre>
<p>Y podemos agregar una nueva propiedad para negar nuestras aserciones:</p>
<pre is:raw="" class="astro-code" style="background-color: #282A36; overflow-x: auto;"><code><span class="line"><span style="color: #FF79C6">const</span><span style="color: #F8F8F2"> isNot </span><span style="color: #FF79C6">=</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">  </span><span style="color: #50FA7B">onAccess</span><span style="color: #F8F8F2">(</span><span style="color: #FFB86C">context</span><span style="color: #F8F8F2">) {</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #6272A4">// Cambiamos el valor de `negated` a `true`</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #6272A4">// para que futuras aserciones tengan conocimiento</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #6272A4">// de esto.</span></span>
<span class="line"><span style="color: #F8F8F2">    context.negated </span><span style="color: #FF79C6">=</span><span style="color: #F8F8F2"> </span><span style="color: #BD93F9">true</span><span style="color: #F8F8F2">;</span></span>
<span class="line"><span style="color: #F8F8F2">  },</span></span>
<span class="line"><span style="color: #F8F8F2">};</span></span></code></pre>
<p>Y nuestra función <code>expect</code> tendrá que llamar cada handler con un objeto <code>context</code> en lugar del valor siendo validado:</p>
<pre is:raw="" class="astro-code" style="background-color: #282A36; overflow-x: auto;"><code><span class="line"><span style="color: #FF79C6">const</span><span style="color: #F8F8F2"> properties </span><span style="color: #FF79C6">=</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">  null</span><span style="color: #FF79C6">:</span><span style="color: #F8F8F2"> isNull,</span></span>
<span class="line"><span style="color: #F8F8F2">  equal</span><span style="color: #FF79C6">:</span><span style="color: #F8F8F2"> isEqual,</span></span>
<span class="line"><span style="color: #F8F8F2">  not</span><span style="color: #FF79C6">:</span><span style="color: #F8F8F2"> isNot,</span></span>
<span class="line"><span style="color: #F8F8F2">};</span></span>
<span class="line"></span>
<span class="line"><span style="color: #FF79C6">export</span><span style="color: #F8F8F2"> </span><span style="color: #FF79C6">function</span><span style="color: #F8F8F2"> </span><span style="color: #50FA7B">expect</span><span style="color: #F8F8F2">(</span><span style="color: #FFB86C">value</span><span style="color: #F8F8F2">) {</span></span>
<span class="line"><span style="color: #F8F8F2">  </span><span style="color: #6272A4">// Nuestro objeto `context`</span></span>
<span class="line"><span style="color: #F8F8F2">  </span><span style="color: #FF79C6">const</span><span style="color: #F8F8F2"> context </span><span style="color: #FF79C6">=</span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">    actual</span><span style="color: #FF79C6">:</span><span style="color: #F8F8F2"> value,</span></span>
<span class="line"><span style="color: #F8F8F2">    negated</span><span style="color: #FF79C6">:</span><span style="color: #F8F8F2"> </span><span style="color: #BD93F9">false</span><span style="color: #F8F8F2">,</span></span>
<span class="line"><span style="color: #F8F8F2">  };</span></span>
<span class="line"><span style="color: #F8F8F2">  </span><span style="color: #FF79C6">const</span><span style="color: #F8F8F2"> proxy </span><span style="color: #FF79C6">=</span><span style="color: #F8F8F2"> </span><span style="color: #FF79C6; font-style: italic">new</span><span style="color: #F8F8F2"> </span><span style="color: #50FA7B">Proxy</span><span style="color: #F8F8F2">(properties, {</span></span>
<span class="line"><span style="color: #F8F8F2">    </span><span style="color: #50FA7B">get</span><span style="color: #F8F8F2">(</span><span style="color: #FFB86C">target</span><span style="color: #F8F8F2">, </span><span style="color: #FFB86C">outerProp</span><span style="color: #F8F8F2">) {</span></span>
<span class="line"><span style="color: #F8F8F2">      </span><span style="color: #FF79C6">const</span><span style="color: #F8F8F2"> property </span><span style="color: #FF79C6">=</span><span style="color: #F8F8F2"> target[outerProp];</span></span>
<span class="line"><span style="color: #F8F8F2">      property?.</span><span style="color: #50FA7B">onAccess</span><span style="color: #F8F8F2">?.(context);</span></span>
<span class="line"><span style="color: #F8F8F2">      </span><span style="color: #FF79C6">return</span><span style="color: #F8F8F2"> </span><span style="color: #FF79C6; font-style: italic">new</span><span style="color: #F8F8F2"> </span><span style="color: #50FA7B">Proxy</span><span style="color: #F8F8F2">(</span></span>
<span class="line"><span style="color: #F8F8F2">        (</span><span style="color: #FF79C6">...</span><span style="color: #FFB86C">args</span><span style="color: #F8F8F2">) </span><span style="color: #FF79C6">=></span><span style="color: #F8F8F2"> {</span></span>
<span class="line"><span style="color: #F8F8F2">          property?.</span><span style="color: #50FA7B">onCall</span><span style="color: #F8F8F2">?.(context, </span><span style="color: #FF79C6">...</span><span style="color: #F8F8F2">args);</span></span>
<span class="line"><span style="color: #F8F8F2">          </span><span style="color: #FF79C6">return</span><span style="color: #F8F8F2"> proxy;</span></span>
<span class="line"><span style="color: #F8F8F2">        },</span></span>
<span class="line"><span style="color: #F8F8F2">        {</span></span>
<span class="line"><span style="color: #F8F8F2">          </span><span style="color: #50FA7B">get</span><span style="color: #F8F8F2">(</span><span style="color: #FFB86C">_</span><span style="color: #F8F8F2">, </span><span style="color: #FFB86C">innerProp</span><span style="color: #F8F8F2">) {</span></span>
<span class="line"><span style="color: #F8F8F2">            </span><span style="color: #FF79C6">return</span><span style="color: #F8F8F2"> proxy[innerProp];</span></span>
<span class="line"><span style="color: #F8F8F2">          },</span></span>
<span class="line"><span style="color: #F8F8F2">        }</span></span>
<span class="line"><span style="color: #F8F8F2">      );</span></span>
<span class="line"><span style="color: #F8F8F2">    },</span></span>
<span class="line"><span style="color: #F8F8F2">  });</span></span>
<span class="line"><span style="color: #F8F8F2">  </span><span style="color: #FF79C6">return</span><span style="color: #F8F8F2"> proxy;</span></span>
<span class="line"><span style="color: #F8F8F2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #50FA7B">expect</span><span style="color: #F8F8F2">(</span><span style="color: #E9F284">'</span><span style="color: #F1FA8C">a</span><span style="color: #E9F284">'</span><span style="color: #F8F8F2">).to.not.</span><span style="color: #50FA7B">equal</span><span style="color: #F8F8F2">(</span><span style="color: #E9F284">'</span><span style="color: #F1FA8C">b</span><span style="color: #E9F284">'</span><span style="color: #F8F8F2">);</span></span></code></pre>
<p>Esta técnica puede ser usada para comunicar más detalles a nuestras aserciones futuras.</p>
<h2 id="evitar-lanzar-errores-normales">Evitar lanzar errores normales</h2>
<p>Para hacer que los ejemplos sean mas sencillos, estuvimos lanzando errores normales (<code>throw new Error(…)</code>). Ya que queremos que esta librería sea usada con un test runner, sería mejor lanzar algo como un <a href="https://nodejs.org/api/assert.html#class-assertassertionerror"><code>AssertionError</code></a> de Node; o, en el caso de uvu, su error <code>Assertion</code>. Esto nos daría mucha más información si una aserción falla. Y puede ser recibido por Node o test runners para mostrar mejores mensajes y diffs.</p>
<h2 id="conclusión">Conclusión</h2>
<p>Esta es una explicación muy simplificada sobre como hice <a href="https://github.com/pablo-abc/uvu-expect">uvu-expect</a>. <code>uvu-expect</code> tiene muchas más funcionalidades y validaciones como:</p>
<ul>
<li><code>.resolves</code> y <code>.rejects</code> para realizar aserciones en promesas.</li>
<li>Posibilidad de crear plugins usando la función <code>extend</code>. Así fue como cree un plugin llamado <a href="https://github.com/pablo-abc/uvu-expect-dom">uvu-expect-dom</a> que ofrece aserciones similares a <code>@testing-library/jest-dom</code>.</li>
<li>Aserciones sobre funciones “mock”. Compatible con <a href="https://sinonjs.org">sinonjs</a> y <a href="https://github.com/Aslemammad/tinyspy">tinyspy</a>.</li>
</ul>
<p>El objetivo era tener por lo menos las funcionalidades que uso de Jest. Puedes leer más sobre esta librería en su README. Escribí documentación sobre todo ahí, incluso como crear tus propios plugins.</p>
<p>Esto fue un proyecto muy divertido para construir y explicar. Y ha funcionado muy bien con nuestros <a href="https://github.com/pablo-abc/felte/blob/main/packages/common/tests/utils.spec.ts">tests en Felte</a>.</p>
        </section>
      </article>
      
      <footer class="astro-TLGC2LXC">
        <ul class="share-buttons svelte-1311d53"><li class="svelte-1311d53">Compártelo:</li>
  <li class="svelte-1311d53"><a href="https://www.facebook.com/sharer/sharer.php?u=https://pablo.berganza.dev/es/creating-a-chai-like-assertion-library-using-proxies&amp;quote=undefined" target="_blank" title="Share on Facebook" rel="noopener noreferrer"><svg aria-hidden="true" class="fa-svelte  svelte-1d15yci" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M400 32H48A48 48 0 0 0 0 80v352a48 48 0 0 0 48 48h137.25V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.27c-30.81 0-40.42 19.12-40.42 38.73V256h68.78l-11 71.69h-57.78V480H400a48 48 0 0 0 48-48V80a48 48 0 0 0-48-48z"></path></svg>
  <span class="sr-only svelte-12xlsax">Share on Facebook</span>
</a></li>
  <li class="svelte-1311d53"><a href="https://twitter.com/intent/tweet?source=https://pablo.berganza.dev/es/creating-a-chai-like-assertion-library-using-proxies&amp;text=undefined:%20https://pablo.berganza.dev/es/creating-a-chai-like-assertion-library-using-proxies&amp;via=Pablo_ABC" target="_blank" title="Tweet" rel="noopener noreferrer"><svg aria-hidden="true" class="fa-svelte  svelte-1d15yci" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zm-48.9 158.8c.2 2.8.2 5.7.2 8.5 0 86.7-66 186.6-186.6 186.6-37.2 0-71.7-10.8-100.7-29.4 5.3.6 10.4.8 15.8.8 30.7 0 58.9-10.4 81.4-28-28.8-.6-53-19.5-61.3-45.5 10.1 1.5 19.2 1.5 29.6-1.2-30-6.1-52.5-32.5-52.5-64.4v-.8c8.7 4.9 18.9 7.9 29.6 8.3a65.447 65.447 0 0 1-29.2-54.6c0-12.2 3.2-23.4 8.9-33.1 32.3 39.8 80.8 65.8 135.2 68.6-9.3-44.5 24-80.6 64-80.6 18.9 0 35.9 7.9 47.9 20.7 14.8-2.8 29-8.3 41.6-15.8-4.9 15.2-15.2 28-28.8 36.1 13.2-1.4 26-5.1 37.8-10.2-8.9 13.1-20.1 24.7-32.9 34z"></path></svg>
  <span class="sr-only svelte-12xlsax">Tweet</span>
</a></li>
  <li class="svelte-1311d53"><a href="https://getpocket.com/save?url=https://pablo.berganza.dev/es/creating-a-chai-like-assertion-library-using-proxies&amp;title=undefined" target="_blank" title="Add to Pocket" rel="noopener noreferrer"><svg aria-hidden="true" class="fa-svelte  svelte-1d15yci" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M407.6 64h-367C18.5 64 0 82.5 0 104.6v135.2C0 364.5 99.7 464 224.2 464c124 0 223.8-99.5 223.8-224.2V104.6c0-22.4-17.7-40.6-40.4-40.6zm-162 268.5c-12.4 11.8-31.4 11.1-42.4 0C89.5 223.6 88.3 227.4 88.3 209.3c0-16.9 13.8-30.7 30.7-30.7 17 0 16.1 3.8 105.2 89.3 90.6-86.9 88.6-89.3 105.5-89.3 16.9 0 30.7 13.8 30.7 30.7 0 17.8-2.9 15.7-114.8 123.2z"></path></svg>
  <span class="sr-only svelte-12xlsax">Add to Pocket</span>
</a></li>
  <li class="svelte-1311d53"><a href="http://www.reddit.com/submit?url=https://pablo.berganza.dev/es/creating-a-chai-like-assertion-library-using-proxies&amp;title=undefined" target="_blank" title="Submit to Reddit" rel="noopener noreferrer"><svg aria-hidden="true" class="fa-svelte  svelte-1d15yci" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M283.2 345.5c2.7 2.7 2.7 6.8 0 9.2-24.5 24.5-93.8 24.6-118.4 0-2.7-2.4-2.7-6.5 0-9.2 2.4-2.4 6.5-2.4 8.9 0 18.7 19.2 81 19.6 100.5 0 2.4-2.3 6.6-2.3 9 0zm-91.3-53.8c0-14.9-11.9-26.8-26.5-26.8-14.9 0-26.8 11.9-26.8 26.8 0 14.6 11.9 26.5 26.8 26.5 14.6 0 26.5-11.9 26.5-26.5zm90.7-26.8c-14.6 0-26.5 11.9-26.5 26.8 0 14.6 11.9 26.5 26.5 26.5 14.9 0 26.8-11.9 26.8-26.5 0-14.9-11.9-26.8-26.8-26.8zM448 80v352c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V80c0-26.5 21.5-48 48-48h352c26.5 0 48 21.5 48 48zm-99.7 140.6c-10.1 0-19 4.2-25.6 10.7-24.1-16.7-56.5-27.4-92.5-28.6l18.7-84.2 59.5 13.4c0 14.6 11.9 26.5 26.5 26.5 14.9 0 26.8-12.2 26.8-26.8 0-14.6-11.9-26.8-26.8-26.8-10.4 0-19.3 6.2-23.8 14.9l-65.7-14.6c-3.3-.9-6.5 1.5-7.4 4.8l-20.5 92.8c-35.7 1.5-67.8 12.2-91.9 28.9-6.5-6.8-15.8-11-25.9-11-37.5 0-49.8 50.4-15.5 67.5-1.2 5.4-1.8 11-1.8 16.7 0 56.5 63.7 102.3 141.9 102.3 78.5 0 142.2-45.8 142.2-102.3 0-5.7-.6-11.6-2.1-17 33.6-17.2 21.2-67.2-16.1-67.2z"></path></svg>
  <span class="sr-only svelte-12xlsax">Submit to Reddit</span>
</a></li>
  <li class="svelte-1311d53"><a href="http://www.linkedin.com/shareArticle?mini=true&amp;url=https://pablo.berganza.dev/es/creating-a-chai-like-assertion-library-using-proxies&amp;title=undefined&amp;summary=undefined&amp;source=https://pablo.berganza.dev/es/creating-a-chai-like-assertion-library-using-proxies" target="_blank" title="Share on LinkedIn" rel="noopener noreferrer"><svg aria-hidden="true" class="fa-svelte  svelte-1d15yci" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg>
  <span class="sr-only svelte-12xlsax">Share on LinkedIn</span>
</a></li>
</ul>
        <style>astro-island,astro-slot{display:contents}</style><script>(self.Astro=self.Astro||{}).only=t=>{(async()=>await(await t())())()},window.dispatchEvent(new Event("astro:only"));var l;{const c={0:t=>t,1:t=>JSON.parse(t,o),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(JSON.parse(t,o)),5:t=>new Set(JSON.parse(t,o)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(JSON.parse(t)),9:t=>new Uint16Array(JSON.parse(t)),10:t=>new Uint32Array(JSON.parse(t))},o=(t,s)=>{if(t===""||!Array.isArray(s))return s;const[e,n]=s;return e in c?c[e](n):void 0};customElements.get("astro-island")||customElements.define("astro-island",(l=class extends HTMLElement{constructor(){super(...arguments);this.hydrate=()=>{if(!this.hydrator||this.parentElement&&this.parentElement.closest("astro-island[ssr]"))return;const s=this.querySelectorAll("astro-slot"),e={},n=this.querySelectorAll("template[data-astro-template]");for(const r of n){const i=r.closest(this.tagName);!i||!i.isSameNode(this)||(e[r.getAttribute("data-astro-template")||"default"]=r.innerHTML,r.remove())}for(const r of s){const i=r.closest(this.tagName);!i||!i.isSameNode(this)||(e[r.getAttribute("name")||"default"]=r.innerHTML)}const a=this.hasAttribute("props")?JSON.parse(this.getAttribute("props"),o):{};this.hydrator(this)(this.Component,a,e,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),window.removeEventListener("astro:hydrate",this.hydrate),window.dispatchEvent(new CustomEvent("astro:hydrate"))}}connectedCallback(){!this.hasAttribute("await-children")||this.firstChild?this.childrenConnectedCallback():new MutationObserver((s,e)=>{e.disconnect(),this.childrenConnectedCallback()}).observe(this,{childList:!0})}async childrenConnectedCallback(){window.addEventListener("astro:hydrate",this.hydrate);let s=this.getAttribute("before-hydration-url");s&&await import(s),this.start()}start(){const s=JSON.parse(this.getAttribute("opts")),e=this.getAttribute("client");if(Astro[e]===void 0){window.addEventListener(`astro:${e}`,()=>this.start(),{once:!0});return}Astro[e](async()=>{const n=this.getAttribute("renderer-url"),[a,{default:r}]=await Promise.all([import(this.getAttribute("component-url")),n?import(n):()=>()=>{}]),i=this.getAttribute("component-export")||"default";if(!i.includes("."))this.Component=a[i];else{this.Component=a;for(const d of i.split("."))this.Component=this.Component[d]}return this.hydrator=r,this.hydrate},s,this)}attributeChangedCallback(){this.hydrator&&this.hydrate()}},l.observedAttributes=["props"],l))}</script><astro-island uid="G9R2y" component-url="/Commento.37233638.js" component-export="default" renderer-url="/client.76ca2f31.js" props="{&quot;lang&quot;:[0,&quot;es&quot;],&quot;src&quot;:[0,&quot;https://cdn.commento.io/js/commento.js&quot;],&quot;class&quot;:[0,&quot;astro-TLGC2LXC&quot;]}" ssr="" client="only" opts="{&quot;name&quot;:&quot;Commento&quot;,&quot;value&quot;:true}"></astro-island>
      </footer>
    </main>
    
  </body>
</html>