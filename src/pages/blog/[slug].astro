---
import PostLayout from '../../layouts/PostLayout.astro';
export async function getStaticPaths({ rss }) {
  const posts = Astro.fetchContent('../../posts/en/*.md');
  const slugs = posts.map((post) => post.slug);

  rss({
    title: 'Blog | Pablo Berganza',
    stylesheet: true,
    description: 'Articles about web dev among other things',
    customData: '<language>en-us</language>',
    items: posts
      .sort((a, b) => {
        return (
          new Date(b.created).getTime() -
            new Date(a.created).getTime()
        )
      })
      .map(item => ({
        title: item.title,
        description: item.description,
        link: item
          .file
          .pathname
          .replace('/src/posts/en', '/blog')
          .replace('.md', ''),
        pubDate: item.created,
      })),
    dest: '/blog/rss.xml',
  });

  return slugs.map(slug => {
    return {
      params: { slug },
      props: {
        post: posts
          .find(post => {
            post.lang = 'en';
            return post.slug === slug
          })
      },
    }
  });
}

const { post } = Astro.props;
---

<PostLayout content={post}>
  {post.content.html}
</PostLayout>
