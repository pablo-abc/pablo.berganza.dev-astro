---
import Base from '../../../layouts/Base.astro';
import LangLink from '../../../components/LangLink.astro';
import HomeLink from '../../../components/HomeLink.astro';
import Blogs from '../../../components/Blog/Blogs.astro';

export async function getStaticPaths() {
  const posts = Astro.fetchContent('../*.md');
  const possibleTags = new Set();
  for (const post of posts) {
    for (const tag of post.tags) {
      possibleTags.add(tag);
    }
  }

  return Array.from(possibleTags).map(tag => {
    return {
      params: { tag },
      props: {
        posts: posts
          .filter(post => post.tags.includes(tag))
          .sort((a, b) => {
            return (
              new Date(b.created).getTime() -
                new Date(a.created).getTime()
            )
          }),
      },
    }
  });
}

const { tag } = Astro.request.params;
const { posts } = Astro.props;
const section = `blog/tags/${tag}`;
---

<Base lang="en" {section}>
  <Blogs {posts} lang="en" {tag} title={`Tag: ${tag}`} />
</Base>
