---
import PostLayout from 'layouts:PostLayout.astro';
export async function getStaticPaths({ rss }) {
  const posts = Astro.fetchContent('../../../posts/es/*.md');
  const slugs = posts.map((post) => post.slug);

  rss({
    title: 'Blog | Pablo Berganza',
    stylesheet: true,
    description: 'Articulos sobre desarrollo web entre otras cosas',
    customData: '<language>es-sv</language>',
    items: posts
      .filter((post) => {
        if (import.meta.env.PROD) {
          return post.published;
        }
        return true;
      })
      .sort((a, b) => {
        return (
          new Date(b.created).getTime() -
            new Date(a.created).getTime()
        )
      })
      .map(item => ({
        title: item.title,
        description: item.description,
        link: item
          .file
          .pathname
          .replace('/src/posts/es', '/es/blog')
          .replace('.md', ''),
        pubDate: item.created,
      })),
    dest: '/es/blog/rss.xml',
  });

  return slugs.map(slug => {
    return {
      params: { slug },
      props: {
        post: posts
          .find(post => {
            post.lang = 'es';
            return post.slug === slug
          })
      },
    }
  });
}

const { post } = Astro.props;
---

<PostLayout content={post}>
  {post.content.html}
</PostLayout>
